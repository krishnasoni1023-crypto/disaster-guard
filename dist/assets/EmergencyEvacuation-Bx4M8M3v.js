import{c as w,u as H,r as a,s as n,j as e,d as R}from"./index-DeG7gfPn.js";import{P as F}from"./phone-CZ4etiK4.js";import{m as j}from"./proxy-DDLR_7cQ.js";import{f as I}from"./format-sbWH3_uq.js";import{M as L}from"./map-pin-ocWYqDe0.js";import{X as M}from"./x-BsEcLwr7.js";import{A as $}from"./alert-triangle-sA03gO4B.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=w("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=w("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),J=()=>{const{user:i}=H(),[x,o]=a.useState([]),[v,E]=a.useState([]),[S,u]=a.useState(!0),[p,h]=a.useState(""),[k,y]=a.useState(!1),[g,c]=a.useState(null);a.useEffect(()=>{(async()=>{if(i){u(!0),c(null);try{const{data:l,error:r}=await n.from("alerts").select("*").order("created_at",{ascending:!1}),{data:t,error:D}=await n.from("alert_responses").select("*").eq("user_id",i.id);if(r||D){c("Failed to fetch alerts data. Please try again later.");return}const f=new Map(t.map(m=>[m.alert_id,m.response])),P=l.map(m=>({...m,responded:f.has(m.id),response:f.get(m.id)}));o(P);const{data:q,error:Q}=await n.from("shelters").select("*");if(Q){c("Failed to fetch shelters data. Please try again later.");return}E(q)}catch{c("An unexpected error occurred. Please try again later.")}finally{u(!1)}}})();const d=n.channel("realtime alerts").on("postgres_changes",{event:"INSERT",schema:"public",table:"alerts"},l=>{const r=l.new;o(t=>[{...r,responded:!1},...t])}).subscribe();return()=>{n.removeChannel(d)}},[i]);const b=async(s,d)=>{if(!i)return;o(r=>r.map(t=>t.id===s?{...t,responded:!0,response:d}:t));const{error:l}=await n.from("alert_responses").insert({alert_id:s,user_id:i.id,response:d});l&&(c("Failed to submit response. Please try again."),o(r=>r.map(t=>t.id===s?{...t,responded:!1,response:void 0}:t)))},A=s=>{s.preventDefault(),p.trim()&&(y(!0),h(""),setTimeout(()=>y(!1),3e3))},C=s=>{switch(s){case"low":return"border-blue-400 bg-blue-50";case"medium":return"border-yellow-400 bg-yellow-50";case"high":return"border-orange-400 bg-orange-50";case"critical":return"border-red-400 bg-red-50";default:return"border-gray-400 bg-gray-50"}},_=s=>{switch(s){case"low":return"ðŸ“¢";case"medium":return"âš ï¸";case"high":return"ðŸ”¶";case"critical":return"ðŸš¨";default:return"ðŸ“¢"}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Emergency Evacuation"}),e.jsx("div",{className:"flex items-center",children:e.jsxs("a",{href:"tel:112",className:"w-full sm:w-auto inline-flex items-center justify-center px-3 sm:px-4 py-2 bg-red-600 text-white text-sm sm:text-base rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(F,{className:"h-4 w-4 mr-1.5 sm:mr-2"}),"Emergency: 112"]})})]}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:g}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Active Evacuation Alerts"}),S?e.jsx("div",{className:"flex justify-center items-center h-48",children:e.jsx(R,{className:"h-6 w-6 sm:h-8 sm:w-8 animate-spin text-blue-600"})}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:x.length===0?e.jsx("p",{className:"text-center text-sm sm:text-base text-gray-500 py-6 sm:py-8",children:"No active alerts at the moment."}):x.map(s=>e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`p-3 sm:p-4 rounded-lg border-2 ${C(s.severity)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg sm:text-xl mr-1.5 sm:mr-2",children:_(s.severity)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-gray-900",children:s.title}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 capitalize",children:[s.severity," Alert"]})]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:I(new Date(s.created_at),"HH:mm")})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-700 mb-2 sm:mb-3",children:s.message}),e.jsxs("div",{className:"flex items-center text-xs sm:text-sm text-gray-600 mb-3 sm:mb-4",children:[e.jsx(L,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),s.location]}),s.responded?e.jsx("div",{className:`p-2 sm:p-3 rounded-lg ${s.response==="yes"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:s.response==="yes"?"âœ“ You marked yourself as safe/evacuated":"âš ï¸ Help request sent to authorities"})}):e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsxs("button",{onClick:()=>b(s.id,"yes"),className:"flex-1 inline-flex items-center justify-center px-3 sm:px-4 py-2 bg-green-600 text-white text-xs sm:text-sm rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(N,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 sm:mr-2"}),"Evacuated / Safe"]}),e.jsxs("button",{onClick:()=>b(s.id,"no"),className:"flex-1 inline-flex items-center justify-center px-3 sm:px-4 py-2 bg-red-600 text-white text-xs sm:text-sm rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(M,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 sm:mr-2"}),"Need Help"]})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Help & Query Portal"}),k?e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-6 sm:py-8",children:[e.jsx(N,{className:"h-10 w-10 sm:h-12 sm:w-12 text-green-500 mx-auto mb-2 sm:mb-3"}),e.jsx("p",{className:"text-sm sm:text-base text-green-600 font-medium",children:"Query submitted successfully!"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:"Emergency response team will contact you shortly."})]}):e.jsxs("form",{onSubmit:A,className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"query",className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1.5 sm:mb-2",children:"Describe your situation or ask for help"}),e.jsx("textarea",{id:"query",rows:4,value:p,onChange:s=>h(s.target.value),placeholder:"Example: Need immediate evacuation assistance for elderly family member...",className:"w-full px-3 py-2 text-xs sm:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("button",{type:"submit",className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white text-xs sm:text-sm rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center",children:[e.jsx($,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 sm:mr-2"}),"Submit Emergency Query"]})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Nearby Safe Shelters"}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:v.map(s=>e.jsxs("div",{className:"p-3 sm:p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm sm:text-base text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:s.address})]}),e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${s.capacity>50?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:[s.capacity,"% Available"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[s.distance,"km away"]}),e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(s.address)}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 hover:text-blue-700",children:[e.jsx(T,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1"}),"Directions"]})]})]},s.id))})]})})]})]})};export{J as default};
