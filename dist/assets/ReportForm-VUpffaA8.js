import{c as j,a as $,u as _,r as c,j as e,d as b,s as g}from"./index-UtJVuj5K.js";import{T as D}from"./triangle-alert-_G82QsY0.js";import{M as R}from"./map-pin-DrvJnmpR.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],A=j("camera",q);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],M=j("send",I),y=5*1024*1024,B=["image/jpeg","image/png","image/jpg"],H=()=>{const v=$(),{user:h}=_(),[d,m]=c.useState(!1),[p,o]=c.useState(null),[w,N]=c.useState(!1),[a,u]=c.useState({title:"",description:"",type:"flood",severity:"medium",location:"",lat:0,lng:0,images:[]});c.useEffect(()=>{(async()=>{try{const{data:t}=await g.storage.listBuckets();if(!(t==null?void 0:t.some(r=>r.name==="disaster-reports"))){const{error:r}=await g.storage.createBucket("disaster-reports",{public:!1,fileSizeLimit:y});if(r)throw r}}catch(t){console.error("Error checking/creating bucket:",t),o("System error: Please try again later")}})()},[]);const l=s=>{const{name:t,value:i}=s.target;u(r=>({...r,[t]:i})),o(null)},k=s=>{if(s.target.files){const t=Array.from(s.target.files);if(t.filter(r=>!B.includes(r.type)||r.size>y).length>0){o("Some files were rejected. Please ensure all files are images under 5MB.");return}u(r=>({...r,images:[...r.images,...t]})),o(null)}},F=s=>{u(t=>({...t,images:t.images.filter((i,r)=>r!==s)}))},L=async()=>{if(!navigator.geolocation){o("Geolocation is not supported by your browser");return}try{m(!0);const s=await new Promise((n,x)=>{navigator.geolocation.getCurrentPosition(n,x,{timeout:1e4,enableHighAccuracy:!0})}),{latitude:t,longitude:i}=s.coords,r=await E(t,i);u(n=>({...n,lat:t,lng:i,location:r})),o(null)}catch(s){s.code===1?o("Location access denied. Please enable location services or enter location manually."):s.code===2?o("Location unavailable. Please try again or enter location manually."):s.code===3?o("Location request timed out. Please try again or enter location manually."):o("Failed to get location. Please try again or enter location manually.")}finally{m(!1)}},E=async(s,t)=>{try{const i=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${t}`,{headers:{"User-Agent":"DisasterReportingApp/1.0"}});if(!i.ok)throw new Error("Failed to fetch location name");return(await i.json()).display_name||`${s.toFixed(6)}, ${t.toFixed(6)}`}catch(i){return console.error("Reverse geocoding error:",i),`${s.toFixed(6)}, ${t.toFixed(6)}`}},S=async s=>{if(s.preventDefault(),!a.title.trim()){o("Please enter a title");return}if(!a.description.trim()){o("Please enter a description");return}if(!a.location.trim()){o("Please set a location");return}m(!0),o(null);try{if(!h)throw new Error("You must be logged in to submit a report");const t=[];for(const r of a.images){const n=r.name.split(".").pop(),x=`${Date.now()}-${Math.random().toString(36).substring(7)}.${n}`,P=`reports/${h.id}/${x}`,{error:C,data:f}=await g.storage.from("disaster-reports").upload(P,r,{cacheControl:"3600",upsert:!1});if(C)throw new Error("Failed to upload images. Please try again.");f&&t.push(f.path)}const{error:i}=await g.from("reports").insert([{user_id:h.id,title:a.title.trim(),description:a.description.trim(),type:a.type,severity:a.severity,location:a.location,lat:a.lat,lng:a.lng,images:t,created_at:new Date().toISOString()}]);if(i)throw new Error("Failed to submit report. Please try again.");N(!0),setTimeout(()=>{v("/dashboard")},2e3)}catch(t){o(t.message)}finally{m(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Submit Disaster Report"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Help us track and respond to disasters by submitting detailed reports."})]}),p&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:p})]})}),w&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-700",children:"Report submitted successfully! Redirecting..."})}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Title"}),e.jsx("input",{type:"text",id:"title",name:"title",required:!0,maxLength:100,value:a.title,onChange:l,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Brief title describing the disaster"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",required:!0,maxLength:1e3,value:a.description,onChange:l,rows:4,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Detailed description of the situation"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700",children:"Disaster Type"}),e.jsxs("select",{id:"type",name:"type",required:!0,value:a.type,onChange:l,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"flood",children:"Flood"}),e.jsx("option",{value:"earthquake",children:"Earthquake"}),e.jsx("option",{value:"cyclone",children:"Cyclone"}),e.jsx("option",{value:"landslide",children:"Landslide"}),e.jsx("option",{value:"fire",children:"Fire"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"severity",className:"block text-sm font-medium text-gray-700",children:"Severity Level"}),e.jsxs("select",{id:"severity",name:"severity",required:!0,value:a.severity,onChange:l,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700",children:"Location"}),e.jsxs("div",{className:"mt-1 flex gap-2",children:[e.jsx("input",{type:"text",id:"location",name:"location",required:!0,value:a.location,onChange:l,className:"block w-full rounded-md border border-gray-300 px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Location of the disaster"}),e.jsx("button",{type:"button",onClick:L,disabled:d,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:d?e.jsx(b,{className:"h-5 w-5 animate-spin"}):e.jsx(R,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Images"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{htmlFor:"images",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsx("span",{children:"Upload images"}),e.jsx("input",{id:"images",name:"images",type:"file",multiple:!0,accept:"image/*",onChange:k,className:"sr-only"})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG up to 5MB"})]})}),a.images.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 sm:grid-cols-3",children:a.images.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`Preview ${t+1}`,className:"h-24 w-full object-cover rounded-lg"}),e.jsxs("button",{type:"button",onClick:()=>F(t),className:"absolute top-0 right-0 -mt-2 -mr-2 bg-red-100 text-red-600 rounded-full p-1 hover:bg-red-200",children:[e.jsx("span",{className:"sr-only",children:"Remove"}),"Ã—"]})]},t))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:d,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"animate-spin -ml-1 mr-2 h-5 w-5"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"-ml-1 mr-2 h-5 w-5"}),"Submit Report"]})})})]})]})};export{H as default};
