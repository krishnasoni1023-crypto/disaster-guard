import{c as w,r as i,a as A,b as I,u as P,j as e,S as E,s as b}from"./index-DeG7gfPn.js";import{U as L}from"./user-BdaVWNel.js";import{P as U}from"./phone-CZ4etiK4.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=w("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=w("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=w("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),R=()=>{const[t,u]=i.useState(!1),[m,h]=i.useState(!1),[p,o]=i.useState(null),[x,c]=i.useState(null),d=A(),y=I(),{session:v}=P(),[a,j]=i.useState({email:"",password:"",fullName:"",mobile:"",aadhaar:"",address:""});i.useEffect(()=>{var l;if(v){const s=((l=y.state)==null?void 0:l.from)||"/dashboard";d(s,{replace:!0})}},[v,d,y]);const n=l=>{j(s=>({...s,[l.target.name]:l.target.value}))},k=async l=>{try{const{error:s}=await b.from("profiles").insert([{id:l,full_name:a.fullName,mobile:a.mobile,aadhaar:a.aadhaar||null,address:a.address,updated_at:new Date().toISOString()}]);if(s)throw s}catch(s){throw console.error("Error creating profile:",s),new Error("Failed to create profile")}},C=async l=>{var s,N,S;l.preventDefault(),h(!0),o(null),c(null);try{if(t){const{data:r,error:f}=await b.auth.signUp({email:a.email,password:a.password,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(f)throw f;if(((N=(s=r.user)==null?void 0:s.identities)==null?void 0:N.length)===0){o("This email is already registered. Please try signing in.");return}r.user&&(await k(r.user.id),c("Success! Please check your email to verify your account."))}else{const{error:r}=await b.auth.signInWithPassword({email:a.email,password:a.password});if(r)throw r;const f=((S=y.state)==null?void 0:S.from)||"/dashboard";d(f,{replace:!0})}}catch(r){r instanceof Error?o(r.message):typeof r=="object"&&r!==null&&"error_description"in r?o(r.error_description):o("An unexpected error occurred")}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx(E,{className:"h-6 w-6 text-white"})}),e.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:t?"Create an Account":"Welcome Back"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t?"Join DisasterGuard to help your community in India":"Sign in to access your dashboard"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:C,children:[e.jsxs("div",{className:"space-y-4",children:[t&&e.jsx(g,{icon:L,name:"fullName",type:"text",placeholder:"Full Name",value:a.fullName,onChange:n,required:!0}),e.jsx(g,{icon:q,name:"email",type:"email",placeholder:"Email address",value:a.email,onChange:n,required:!0}),e.jsx(g,{icon:M,name:"password",type:"password",placeholder:"Password",value:a.password,onChange:n,required:!0}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{className:"h-5 w-5 text-gray-400"})}),e.jsx("span",{className:"absolute inset-y-0 left-10 pl-1 flex items-center text-gray-500 sm:text-sm",children:"+91"}),e.jsx("input",{id:"mobile",name:"mobile",type:"tel",required:!0,pattern:"[0-9]{10}",maxLength:10,className:"appearance-none relative block w-full pl-20 pr-3 py-3 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Mobile Number",value:a.mobile,onChange:n})]}),e.jsx(g,{icon:D,name:"aadhaar",type:"text",placeholder:"Aadhaar Number (Optional)",pattern:"[0-9]{12}",maxLength:12,value:a.aadhaar,onChange:n}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"sr-only",children:"Current Address"}),e.jsx("textarea",{id:"address",name:"address",required:!0,rows:3,className:"appearance-none relative block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Current Address (e.g. 123, MG Road, Bangalore)",value:a.address,onChange:n})]})]})]}),p&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:p}),x&&e.jsx("p",{className:"text-sm text-green-600 text-center",children:x}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:m,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:m?"Processing...":t?"Sign Up":"Sign In"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>{u(!t),o(null),c(null),j({email:"",password:"",fullName:"",mobile:"",aadhaar:"",address:""})},className:"font-medium text-sm text-blue-600 hover:text-blue-500",children:t?"Already have an account? Sign In":"Don't have an account? Sign Up"})})]})]})})},g=({icon:t,name:u,type:m,placeholder:h,value:p,onChange:o,required:x,pattern:c,maxLength:d})=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(t,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:u,name:u,type:m,required:x,pattern:c,maxLength:d,className:"appearance-none relative block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:h,value:p,onChange:o})]});export{R as default};
